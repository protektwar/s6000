#include <mach/mt_typedefs.h>

#define TEMPERATURE_T0                  110
#define TEMPERATURE_T1                  0
#define TEMPERATURE_T2                  25
#define TEMPERATURE_T3                  50
#define TEMPERATURE_T                   255 // This should be fixed, never change the value

#define FG_METER_RESISTANCE 	0

#define MAX_BOOTING_TIME_FGCURRENT	1*10 // 10s

#if defined(CONFIG_POWER_EXT)
#define OCV_BOARD_COMPESATE	72 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
#else
#define OCV_BOARD_COMPESATE	0 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
#endif

#define Q_MAX_POS_50	6234
#define Q_MAX_POS_25	6234
#define Q_MAX_POS_0		6234
#define Q_MAX_NEG_10	6234

#define Q_MAX_POS_50_H_CURRENT	6112
#define Q_MAX_POS_25_H_CURRENT	6112
#define Q_MAX_POS_0_H_CURRENT	6112
#define Q_MAX_NEG_10_H_CURRENT	6112

#define R_FG_VALUE 				20 // mOhm, base is 20
#define CURRENT_DETECT_R_FG	100  //10mA

#define OSR_SELECT_7			0

#define CAR_TUNE_VALUE			98 //0.98

/////////////////////////////////////////////////////////////////////
// <DOD, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _BATTERY_PROFILE_STRUC
{
    kal_int32 percentage;
    kal_int32 voltage;
} BATTERY_PROFILE_STRUC, *BATTERY_PROFILE_STRUC_P;

typedef enum
{
    T1_0C,
    T2_25C,
    T3_50C
} PROFILE_TEMPERATURE;

// T0 -10C
BATTERY_PROFILE_STRUC battery_profile_t0[] =
{
    {0  , 4190},
    {1  , 4170},
    {3  , 4155},
    {4  , 4141},
    {5  , 4127},
    {6  , 4113},
    {8  , 4100},
    {9  , 4088},
    {10 , 4075},
    {12 , 4061},
    {13 , 4049},
    {14 , 4037},
    {15 , 4026},
    {17 , 4015},
    {18 , 4003},
    {19 , 3992},
    {21 , 3982},
    {22 , 3971},
    {23 , 3961},
    {24 , 3952},
    {26 , 3944},
    {27 , 3933},
    {28 , 3925},
    {29 , 3916},
    {31 , 3907},
    {32 , 3898},
    {33 , 3892},
    {35 , 3884},
    {36 , 3874},
    {37 , 3867},
    {38 , 3857},
    {40 , 3845},
    {41 , 3833},
    {42 , 3822},
    {44 , 3813},
    {45 , 3806},
    {46 , 3799},
    {47 , 3794},
    {49 , 3791},
    {50 , 3788},
    {51 , 3783},
    {53 , 3781},
    {54 , 3781},
    {55 , 3779},
    {56 , 3777},
    {58 , 3775},
    {59 , 3775},
    {60 , 3774},
    {62 , 3773},
    {63 , 3771},
    {64 , 3770},
    {65 , 3768},
    {67 , 3766},
    {68 , 3762},
    {69 , 3757},
    {71 , 3751},
    {72 , 3745},
    {73 , 3737},
    {74 , 3728},
    {76 , 3716},
    {77 , 3702},
    {78 , 3687},
    {80 , 3671},
    {81 , 3654},
    {82 , 3638},
    {83 , 3623},
    {85 , 3610},
    {86 , 3595},
    {87 , 3580},
    {88 , 3568},
    {90 , 3556},
    {91 , 3542},
    {92 , 3528},
    {94 , 3518},
    {95 , 3510},
    {96 , 3500},
    {97 , 3484},
    {99 , 3453},
    {100, 3398}    
};   
     
// T1 0C
BATTERY_PROFILE_STRUC battery_profile_t1[] =
{
    {0  , 4190},
    {1  , 4170},
    {3  , 4155},
    {4  , 4141},
    {5  , 4127},
    {6  , 4113},
    {8  , 4100},
    {9  , 4088},
    {10 , 4075},
    {12 , 4061},
    {13 , 4049},
    {14 , 4037},
    {15 , 4026},
    {17 , 4015},
    {18 , 4003},
    {19 , 3992},
    {21 , 3982},
    {22 , 3971},
    {23 , 3961},
    {24 , 3952},
    {26 , 3944},
    {27 , 3933},
    {28 , 3925},
    {29 , 3916},
    {31 , 3907},
    {32 , 3898},
    {33 , 3892},
    {35 , 3884},
    {36 , 3874},
    {37 , 3867},
    {38 , 3857},
    {40 , 3845},
    {41 , 3833},
    {42 , 3822},
    {44 , 3813},
    {45 , 3806},
    {46 , 3799},
    {47 , 3794},
    {49 , 3791},
    {50 , 3788},
    {51 , 3783},
    {53 , 3781},
    {54 , 3781},
    {55 , 3779},
    {56 , 3777},
    {58 , 3775},
    {59 , 3775},
    {60 , 3774},
    {62 , 3773},
    {63 , 3771},
    {64 , 3770},
    {65 , 3768},
    {67 , 3766},
    {68 , 3762},
    {69 , 3757},
    {71 , 3751},
    {72 , 3745},
    {73 , 3737},
    {74 , 3728},
    {76 , 3716},
    {77 , 3702},
    {78 , 3687},
    {80 , 3671},
    {81 , 3654},
    {82 , 3638},
    {83 , 3623},
    {85 , 3610},
    {86 , 3595},
    {87 , 3580},
    {88 , 3568},
    {90 , 3556},
    {91 , 3542},
    {92 , 3528},
    {94 , 3518},
    {95 , 3510},
    {96 , 3500},
    {97 , 3484},
    {99 , 3453},
    {100, 3398}    
};

// T2 25C
BATTERY_PROFILE_STRUC battery_profile_t2[] =
{
    {0  , 4190},
    {1  , 4170},
    {3  , 4155},
    {4  , 4141},
    {5  , 4127},
    {6  , 4113},
    {8  , 4100},
    {9  , 4088},
    {10 , 4075},
    {12 , 4061},
    {13 , 4049},
    {14 , 4037},
    {15 , 4026},
    {17 , 4015},
    {18 , 4003},
    {19 , 3992},
    {21 , 3982},
    {22 , 3971},
    {23 , 3961},
    {24 , 3952},
    {26 , 3944},
    {27 , 3933},
    {28 , 3925},
    {29 , 3916},
    {31 , 3907},
    {32 , 3898},
    {33 , 3892},
    {35 , 3884},
    {36 , 3874},
    {37 , 3867},
    {38 , 3857},
    {40 , 3845},
    {41 , 3833},
    {42 , 3822},
    {44 , 3813},
    {45 , 3806},
    {46 , 3799},
    {47 , 3794},
    {49 , 3791},
    {50 , 3788},
    {51 , 3783},
    {53 , 3781},
    {54 , 3781},
    {55 , 3779},
    {56 , 3777},
    {58 , 3775},
    {59 , 3775},
    {60 , 3774},
    {62 , 3773},
    {63 , 3771},
    {64 , 3770},
    {65 , 3768},
    {67 , 3766},
    {68 , 3762},
    {69 , 3757},
    {71 , 3751},
    {72 , 3745},
    {73 , 3737},
    {74 , 3728},
    {76 , 3716},
    {77 , 3702},
    {78 , 3687},
    {80 , 3671},
    {81 , 3654},
    {82 , 3638},
    {83 , 3623},
    {85 , 3610},
    {86 , 3595},
    {87 , 3580},
    {88 , 3568},
    {90 , 3556},
    {91 , 3542},
    {92 , 3528},
    {94 , 3518},
    {95 , 3510},
    {96 , 3500},
    {97 , 3484},
    {99 , 3453},
    {100, 3398}    
};

// T3 50C
BATTERY_PROFILE_STRUC battery_profile_t3[] =
{
    {0  , 4190},
    {1  , 4170},
    {3  , 4155},
    {4  , 4141},
    {5  , 4127},
    {6  , 4113},
    {8  , 4100},
    {9  , 4088},
    {10 , 4075},
    {12 , 4061},
    {13 , 4049},
    {14 , 4037},
    {15 , 4026},
    {17 , 4015},
    {18 , 4003},
    {19 , 3992},
    {21 , 3982},
    {22 , 3971},
    {23 , 3961},
    {24 , 3952},
    {26 , 3944},
    {27 , 3933},
    {28 , 3925},
    {29 , 3916},
    {31 , 3907},
    {32 , 3898},
    {33 , 3892},
    {35 , 3884},
    {36 , 3874},
    {37 , 3867},
    {38 , 3857},
    {40 , 3845},
    {41 , 3833},
    {42 , 3822},
    {44 , 3813},
    {45 , 3806},
    {46 , 3799},
    {47 , 3794},
    {49 , 3791},
    {50 , 3788},
    {51 , 3783},
    {53 , 3781},
    {54 , 3781},
    {55 , 3779},
    {56 , 3777},
    {58 , 3775},
    {59 , 3775},
    {60 , 3774},
    {62 , 3773},
    {63 , 3771},
    {64 , 3770},
    {65 , 3768},
    {67 , 3766},
    {68 , 3762},
    {69 , 3757},
    {71 , 3751},
    {72 , 3745},
    {73 , 3737},
    {74 , 3728},
    {76 , 3716},
    {77 , 3702},
    {78 , 3687},
    {80 , 3671},
    {81 , 3654},
    {82 , 3638},
    {83 , 3623},
    {85 , 3610},
    {86 , 3595},
    {87 , 3580},
    {88 , 3568},
    {90 , 3556},
    {91 , 3542},
    {92 , 3528},
    {94 , 3518},
    {95 , 3510},
    {96 , 3500},
    {97 , 3484},
    {99 , 3453},
    {100, 3398}    
};

// battery profile for actual temperature. The size should be the same as T1, T2 and T3
BATTERY_PROFILE_STRUC battery_profile_temperature[] =
{
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0}    
};

/////////////////////////////////////////////////////////////////////
// <Rbat, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _R_PROFILE_STRUC
{
    kal_int32 resistance; // Ohm
    kal_int32 voltage;
} R_PROFILE_STRUC, *R_PROFILE_STRUC_P;

// T0 -10C
R_PROFILE_STRUC r_profile_t0[] =
{
    {155, 4190},
    {80 , 4170},
    {82 , 4155},
    {83 , 4141},
    {87 , 4127},
    {85 , 4113},
    {83 , 4100},
    {85 , 4088},
    {83 , 4075},
    {82 , 4061},
    {85 , 4049},
    {83 , 4037},
    {88 , 4026},
    {90 , 4015},
    {87 , 4003},
    {90 , 3992},
    {90 , 3982},
    {88 , 3971},
    {90 , 3961},
    {92 , 3952},
    {93 , 3944},
    {93 , 3933},
    {93 , 3925},
    {92 , 3916},
    {95 , 3907},
    {93 , 3898},
    {100, 3892},
    {100, 3884},
    {98 , 3874},
    {102, 3867},
    {100, 3857},
    {95 , 3845},
    {88 , 3833},
    {88 , 3822},
    {85 , 3813},
    {83 , 3806},
    {80 , 3799},
    {82 , 3794},
    {83 , 3791},
    {83 , 3788},
    {82 , 3783},
    {82 , 3781},
    {85 , 3781},
    {87 , 3779},
    {87 , 3777},
    {85 , 3775},
    {87 , 3775},
    {90 , 3774},
    {88 , 3773},
    {90 , 3771},
    {93 , 3770},
    {95 , 3768},
    {93 , 3766},
    {95 , 3762},
    {95 , 3757},
    {95 , 3751},
    {100, 3745},
    {102, 3737},
    {102, 3728},
    {100, 3716},
    {102, 3702},
    {100, 3687},
    {100, 3671},
    {100, 3654},
    {98 , 3638},
    {97 , 3623},
    {100, 3610},
    {98 , 3595},
    {98 , 3580},
    {97 , 3568},
    {100, 3556},
    {103, 3542},
    {98 , 3528},
    {102, 3518},
    {105, 3510},
    {110, 3500},
    {117, 3484},
    {118, 3453},
    {128, 3398}    
};

// T1 0C
R_PROFILE_STRUC r_profile_t1[] =
{
    {155, 4190},
    {80 , 4170},
    {82 , 4155},
    {83 , 4141},
    {87 , 4127},
    {85 , 4113},
    {83 , 4100},
    {85 , 4088},
    {83 , 4075},
    {82 , 4061},
    {85 , 4049},
    {83 , 4037},
    {88 , 4026},
    {90 , 4015},
    {87 , 4003},
    {90 , 3992},
    {90 , 3982},
    {88 , 3971},
    {90 , 3961},
    {92 , 3952},
    {93 , 3944},
    {93 , 3933},
    {93 , 3925},
    {92 , 3916},
    {95 , 3907},
    {93 , 3898},
    {100, 3892},
    {100, 3884},
    {98 , 3874},
    {102, 3867},
    {100, 3857},
    {95 , 3845},
    {88 , 3833},
    {88 , 3822},
    {85 , 3813},
    {83 , 3806},
    {80 , 3799},
    {82 , 3794},
    {83 , 3791},
    {83 , 3788},
    {82 , 3783},
    {82 , 3781},
    {85 , 3781},
    {87 , 3779},
    {87 , 3777},
    {85 , 3775},
    {87 , 3775},
    {90 , 3774},
    {88 , 3773},
    {90 , 3771},
    {93 , 3770},
    {95 , 3768},
    {93 , 3766},
    {95 , 3762},
    {95 , 3757},
    {95 , 3751},
    {100, 3745},
    {102, 3737},
    {102, 3728},
    {100, 3716},
    {102, 3702},
    {100, 3687},
    {100, 3671},
    {100, 3654},
    {98 , 3638},
    {97 , 3623},
    {100, 3610},
    {98 , 3595},
    {98 , 3580},
    {97 , 3568},
    {100, 3556},
    {103, 3542},
    {98 , 3528},
    {102, 3518},
    {105, 3510},
    {110, 3500},
    {117, 3484},
    {118, 3453},
    {128, 3398}    
};

// T2 25C
R_PROFILE_STRUC r_profile_t2[] =
{
    {155, 4190},
    {80 , 4170},
    {82 , 4155},
    {83 , 4141},
    {87 , 4127},
    {85 , 4113},
    {83 , 4100},
    {85 , 4088},
    {83 , 4075},
    {82 , 4061},
    {85 , 4049},
    {83 , 4037},
    {88 , 4026},
    {90 , 4015},
    {87 , 4003},
    {90 , 3992},
    {90 , 3982},
    {88 , 3971},
    {90 , 3961},
    {92 , 3952},
    {93 , 3944},
    {93 , 3933},
    {93 , 3925},
    {92 , 3916},
    {95 , 3907},
    {93 , 3898},
    {100, 3892},
    {100, 3884},
    {98 , 3874},
    {102, 3867},
    {100, 3857},
    {95 , 3845},
    {88 , 3833},
    {88 , 3822},
    {85 , 3813},
    {83 , 3806},
    {80 , 3799},
    {82 , 3794},
    {83 , 3791},
    {83 , 3788},
    {82 , 3783},
    {82 , 3781},
    {85 , 3781},
    {87 , 3779},
    {87 , 3777},
    {85 , 3775},
    {87 , 3775},
    {90 , 3774},
    {88 , 3773},
    {90 , 3771},
    {93 , 3770},
    {95 , 3768},
    {93 , 3766},
    {95 , 3762},
    {95 , 3757},
    {95 , 3751},
    {100, 3745},
    {102, 3737},
    {102, 3728},
    {100, 3716},
    {102, 3702},
    {100, 3687},
    {100, 3671},
    {100, 3654},
    {98 , 3638},
    {97 , 3623},
    {100, 3610},
    {98 , 3595},
    {98 , 3580},
    {97 , 3568},
    {100, 3556},
    {103, 3542},
    {98 , 3528},
    {102, 3518},
    {105, 3510},
    {110, 3500},
    {117, 3484},
    {118, 3453},
    {128, 3398}    
};

// T3 50C
R_PROFILE_STRUC r_profile_t3[] =
{
    {155, 4190},
    {80 , 4170},
    {82 , 4155},
    {83 , 4141},
    {87 , 4127},
    {85 , 4113},
    {83 , 4100},
    {85 , 4088},
    {83 , 4075},
    {82 , 4061},
    {85 , 4049},
    {83 , 4037},
    {88 , 4026},
    {90 , 4015},
    {87 , 4003},
    {90 , 3992},
    {90 , 3982},
    {88 , 3971},
    {90 , 3961},
    {92 , 3952},
    {93 , 3944},
    {93 , 3933},
    {93 , 3925},
    {92 , 3916},
    {95 , 3907},
    {93 , 3898},
    {100, 3892},
    {100, 3884},
    {98 , 3874},
    {102, 3867},
    {100, 3857},
    {95 , 3845},
    {88 , 3833},
    {88 , 3822},
    {85 , 3813},
    {83 , 3806},
    {80 , 3799},
    {82 , 3794},
    {83 , 3791},
    {83 , 3788},
    {82 , 3783},
    {82 , 3781},
    {85 , 3781},
    {87 , 3779},
    {87 , 3777},
    {85 , 3775},
    {87 , 3775},
    {90 , 3774},
    {88 , 3773},
    {90 , 3771},
    {93 , 3770},
    {95 , 3768},
    {93 , 3766},
    {95 , 3762},
    {95 , 3757},
    {95 , 3751},
    {100, 3745},
    {102, 3737},
    {102, 3728},
    {100, 3716},
    {102, 3702},
    {100, 3687},
    {100, 3671},
    {100, 3654},
    {98 , 3638},
    {97 , 3623},
    {100, 3610},
    {98 , 3595},
    {98 , 3580},
    {97 , 3568},
    {100, 3556},
    {103, 3542},
    {98 , 3528},
    {102, 3518},
    {105, 3510},
    {110, 3500},
    {117, 3484},
    {118, 3453},
    {128, 3398}    
};

// r-table profile for actual temperature. The size should be the same as T1, T2 and T3
R_PROFILE_STRUC r_profile_temperature[] =
{
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0}    
};


int fgauge_get_saddles(void);
BATTERY_PROFILE_STRUC_P fgauge_get_profile(kal_uint32 temperature);

int fgauge_get_saddles_r_table(void);
R_PROFILE_STRUC_P fgauge_get_profile_r_table(kal_uint32 temperature);

//#define CONFIG_POWER_VERIFY